syntax = "proto3";

// The request to be sent to tracers processes.
message TracerRequest { repeated Action actions = 1; }

// Actions to be executed by tracer processes.
message Action {
  message Create { // Creates the project to be traced.
    string main = 1;
    oneof source {
      string code = 2;
      bytes tar = 3;
    }
  }
  message Start {} // Starts the compilation and tracing of the project.
  message Stop {}  // Stops the tracer process at any moment.
  message Step {}  // Sends a step request to the tracer.
  message Input {  // Sends input to the tracer process.
    repeated string lines = 1;
  }

  oneof action {
    Create create = 1;
    Start start = 2;
    Stop stop = 3;
    Stop step = 4;
    Input input = 5;
  }
}

// The response generated by tracers processes.
message TracerResponse { repeated Result results = 1; }

// Results for the received actions.
message Result {
  message Created {} // Indicates successfull creation.
  message Started {} // Indicates successfull compilation and initialization
  message Frame {}   // Contains the data obtained from the state inspection.
  message Print {    // Contains print messages from the reaced code.
    string value = 1;
  }
  message Lock { // Contains lock causes from the traced code.
    string cause = 1;
  }
  message Error { // Contains any error generated by the tracer.
    enum Source { // The source of the error.
      TRACER = 0; // From tracer.
      TRACED = 1; // From traced code.
    }
    Source source = 0;
    bool terminal = 1;
  }

  oneof result {
    Created created = 1;
    Started started = 2;
    Frame frame = 3;
    Print print = 4;
    Lock lock = 5;
    Error error = 6;
  }
}
