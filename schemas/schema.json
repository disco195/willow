{
    "$schema": "http://json-schema.org/draft-07/schema",
    "description": "Base schema for trace requests (traces) and responses (result)",
    "oneOf": [{ "$ref": "#/definitions/trace" }, { "$ref": "#/definitions/result" }],
    "definitions": {
        "trace": {
            "description": "Trace is a request that can be read by tracer processes",
            "properties": {
                "source": { "type": "string", "description": "The source code to be executed" },
                "input": { "type": "string", "description": "Input to be consumed the the program" },
                "steps": { "type": "number", "description": "Maximum number of program steps" }
            },
            "additionalProperties": false
        },
        "result": {
            "description": "Result stores a list of all computed steps of a program",
            "properties": {
                "steps": { "type": "array", "items": { "$ref": "#/definitions/step" } }
            },
            "additionalProperties": false,
            "required": ["steps"]
        },
        "step": {
            "description": "Step stores the information of a program in a certain point",
            "properties": {
                "snapshot": { "$ref": "#/definitions/snapshot" },
                "prints": { "type": "string", "description": "The content printed during the step" },
                "threw": { "$ref": "#/definitions/threw" }
            },
            "additionalProperties": false
        },
        "snapshot": {
            "description": "Snapshots contains the state of a program in a certain point",
            "properties": {
                "info": {"type":"string", "enum": ["ok", "warn", "error"], "description": "Snapshot info" },
                "stack": { "type": "array", "items": { "$ref": "#/definitions/scope" } },
                "heap": { "type": "object", "additionalProperties": { "$ref": "#/definitions/obj" } }
            },
            "additionalProperties": false,
            "required": ["info", "stack", "heap"]
        },
        "scope": {
            "description": "Scope stores basic data and variables that may point to the heap",
            "properties": {
                "line": { "type": "number", "description": "First line of the scope" },
                "name": { "type": "string", "description": "The scope name" },
                "variables": { "type": "array", "items": { "$ref": "#/definitions/variable" } }
            },
            "additionalProperties": false,
            "required": ["line", "name", "variables"]
        },
        "obj": {
            "description": "Objects in the heap of a program",
            "properties": {
                "gType": { "type": "string", "enum": ["array", "linked", "set", "map"], "description": "General type" },
                "lType": { "type": "string", "description": "Type string in the language" },
                "members": { "type": "array", "items": { "$ref": "#/definitions/member" } }
            },
            "additionalProperties": false,
            "required": ["gType", "lType", "members"]
        },
        "variable": {
            "description": "Variable is a named value from the stack to the heap",
            "properties": {
                "name": { "type": "string", "description": "The variable name in the stack" },
                "value": { "$ref": "#/definitions/value" }
            },
            "additionalProperties": false,
            "required": ["name", "value"]
        },
        "member": {
            "description": "Member is one element of a object of any kind",
            "properties": {
                "key": { "$ref": "#/definitions/value" },
                "value": { "$ref": "#/definitions/value" }
            },
            "additionalProperties": false,
            "required": ["key", "value"]
        },
        "value": {
            "description": "Value is the representation of any program element",
            "oneOf": [
                { "type": "number", "description": "Any number up to +-(2^53 - 1), larger ones must use string" },
                { "type": "string", "description": "boolean, null, large numbers, types and other flat objects" },
                {
                    "description": "Array containing a reference to objects in the heap",
                    "type": "array",
                    "items": { "type": "string" },
                    "minItems": 1,
                    "maxItems": 1
                }
            ]
        },
        "threw": {
            "description": "Indicates that the program stop before finishing or maybe even starting",
            "properties": {
                "cause": { "type": "string", "description": "Controlled threw not caused by the program" },
                "exception": { "$ref": "#/definitions/exception" }
            },
            "additionalProperties": false,
            "minProperties": 1,
            "maxProperties": 1
        },
        "exception": {
            "description": "Exception is an uncaught error of the program or the tracer itself.",
            "properties": {
                "type": { "type": "string", "description": "The string in the language" },
                "traceback": { "type": "string", "description": "The error stacktrace" }
            },
            "additionalProperties": false,
            "required": ["type", "traceback"]
        }
    }
}
