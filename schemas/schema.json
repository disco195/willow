{
    "$schema": "http://json-schema.org/draft-07/schema",
    "description": "Base schema for trace requests (traces) and responses (results).",
    "oneOf": [{ "$ref": "#/definitions/trace" }, { "$ref": "#/definitions/result" }],
    "definitions": {
        "trace": {
            "description": "Trace is a request containing source code, inputs and maximum amount of steps to execute.",
            "properties": {
                "source": { "type": "string", "description": "The source code to be executed." },
                "input": { "type": "string", "description": "Input to be consumed the the program." },
                "steps": { "type": "number", "description": "Maximum number of program steps." }
            },
            "additionalProperties": false
        },
        "result": {
            "description": "Result stores a list of all computed steps of a program.",
            "properties": {
                "steps": { "type": "array", "items": { "$ref": "#/definitions/step" } }
            },
            "additionalProperties": false,
            "required": ["steps"]
        },
        "step": {
            "description": "Step stores the information of a program at a certain execution point.",
            "properties": {
                "snapshot": { "$ref": "#/definitions/snapshot" },
                "prints": { "type": "string", "description": "The content printed at the step." },
                "threw": { "$ref": "#/definitions/threw" }
            },
            "additionalProperties": false
        },
        "snapshot": {
            "description": "Snapshots contains the state of a program at a certain execution point.",
            "properties": {
                "info": { "type": "string", "enum": ["ok", "warn", "error"], "description": "State information." },
                "stack": { "type": "array", "items": { "$ref": "#/definitions/scope" } },
                "heap": { "type": "object", "additionalProperties": { "$ref": "#/definitions/obj" } }
            },
            "additionalProperties": false,
            "required": ["info", "stack", "heap"]
        },
        "scope": {
            "description": "Scope stores basic data and variables that may point to the heap.",
            "properties": {
                "line": { "type": "number", "description": "First line of the scope." },
                "name": { "type": "string", "description": "The scope name." },
                "members": { "type": "array", "items": { "$ref": "#/definitions/members" } }
            },
            "additionalProperties": false,
            "required": ["line", "name", "members"]
        },
        "obj": {
            "description": "Objects in the heap. They must have the same id for different runs of the same program.",
            "properties": {
                "type": { "type": "string", "description": "The object type." },
                "category": { "type": "string", "enum": ["list", "set", "map", "other"], "description": "Category." },
                "members": { "type": "array", "items": { "$ref": "#/definitions/member" } }
            },
            "additionalProperties": false,
            "required": ["type", "category", "members"]
        },
        "member": {
            "description": "Member is a variable of a scope or element of an object.",
            "properties": {
                "key": { "$ref": "#/definitions/value" },
                "value": { "$ref": "#/definitions/value" }
            },
            "additionalProperties": false,
            "required": ["key", "value"]
        },
        "value": {
            "description": "Value is the representation of any program element.",
            "oneOf": [
                { "type": "number", "description": "Any number up to +-(2^53 - 1), larger numbers must use string." },
                { "type": "string", "description": "boolean, nullable, large numbers, types and other flat objects." },
                {
                    "description": "Array containing a reference to a object in the heap.",
                    "type": "array",
                    "items": { "type": "string" },
                    "minItems": 1,
                    "maxItems": 1
                }
            ]
        },
        "threw": {
            "description": "Indicates that the program or the tracer stopped due to some problem.",
            "properties": {
                "cause": { "type": "string", "description": "Forced controlled stop caused by the tracer." },
                "exception": { "$ref": "#/definitions/exception" }
            },
            "additionalProperties": false,
            "minProperties": 1,
            "maxProperties": 1
        },
        "exception": {
            "description": "Uncaught error of the program or the tracer itself.",
            "properties": {
                "type": { "type": "string", "description": "The error type." },
                "traceback": { "type": "string", "description": "The error traceback." }
            },
            "additionalProperties": false,
            "required": ["type", "traceback"]
        }
    }
}
