{
    "$schema": "http://json-schema.org/draft-07/schema",
    "definitions": {
        "trace": {
            "description": "Traces are the requests to be sent to tracers processes. Traces must have a source to be executed and may have some input. The steps property defines the maximum number of steps to inspect.",
            "properties": {
                "source": { "type": "string" },
                "input": { "type": "string" },
                "steps": { "type": "number" }
            },
            "additionalProperties": false
        },
        "result": {
            "description": "Results store a list of all computed steps of a program.",
            "properties": {
                "steps": { "type": "array", "items": { "$ref": "#/definitions/step" } }
            },
            "additionalProperties": false,
            "required": ["steps"]
        },
        "step": {
            "description": "Steps store the results of inspections of the traced program. They shall contain at least one of the snapshot or threw properties and may have 0 or more prints.",
            "properties": {
                "snapshot": { "$ref": "#/definitions/snapshot" },
                "threw": { "$ref": "#/definitions/threw" },
                "prints": { "type": "array", "items": { "type": "string" } }
            },
            "additionalProperties": false
        },
        "snapshot": {
            "description": "Snapshots contains the memory of a program. They store themselves type, if the program ended, any exception raised, the current stack/heap of the program.",
            "properties": {
                "type": {
                    "type": "string",
                    "enum": ["line", "call", "return", "exception"]
                },
                "stack": { "type": "array", "items": { "$ref": "#/definitions/scope" } },
                "heap": { "type": "object", "additionalProperties": { "$ref": "#/definitions/obj" } }
            },
            "additionalProperties": false,
            "required": ["type", "finish", "exception", "stack", "heap"]
        },
        "scope": {
            "description": "Scopes store its name, the line it starts and declared variables.",
            "properties": {
                "line": { "type": "number" },
                "name": { "type": "string" },
                "variables": { "type": "array", "items": { "$ref": "#/definitions/variable" } }
            },
            "additionalProperties": false,
            "required": ["line", "name", "variables"]
        },
        "obj": {
            "description": "Objects in the heap of a program",
            "properties": {
                "type": { "type": "string", "enum": ["array", "tuple", "alist", "llist", "map", "set", "other"] },
                "languageType": { "type": "string" },
                "userDefined": { "type": "boolean" },
                "members": { "type": "array", "items": { "$ref": "#/definitions/member" } }
            },
            "additionalProperties": false,
            "required": ["type", "languageType", "userDefined", "members"]
        },
        "threw": {
            "description": "Contains any exception generated by the tracer program or the traced code compilation, it never happens for traced code exceptions. It also can be a 'cause' problem, usually a constraint of the tracer that does not cause any program exceptions, for example not enough program input or max steps. Threw messages are usually terminal (they stop the tracer program).",
            "properties": {
                "exception": { "$ref": "#/definitions/exception" },
                "cause": { "type": "string" }
            },
            "additionalProperties": false
        },
        "exception": {
            "description": "Exceptions may be from tracer or traced program. They shall contain the exception type, it's creation arguments and traceback.",
            "properties": {
                "type": { "type": "string" },
                "traceback": { "type": "array", "items": { "type": "string" } }
            },
            "additionalProperties": false,
            "required": ["type", "args", "traceback"]
        },
        "variable": {
            "description": "Variables are user created references to values.",
            "properties": {
                "name": { "type": "string" },
                "value": { "$ref": "#/definitions/value" }
            },
            "additionalProperties": false,
            "required": ["name", "value"]
        },
        "member": {
            "description": "Members of objects have a key and value which are Value.",
            "properties": {
                "key": { "$ref": "#/definitions/value" },
                "value": { "$ref": "#/definitions/value" }
            },
            "additionalProperties": false,
            "required": ["key", "value"]
        },
        "value": {
            "description": "Represents programs values. They shall be one of the following ones. Types like boolean, null, or integers larger than what a double can fit (+- 2 ** 53 - 1) must use string representation.",
            "oneOf": [
                { "type": "number" },
                { "type": "string" },
                { "type": "array", "items": { "type": "string" }, "minItems": 1, "maxItems": 1 }
            ]
        }
    },
    "description": "Base schema for trace requests and results",
    "oneOf": [{ "$ref": "#/definitions/trace" }, { "$ref": "#/definitions/result" }]
}
